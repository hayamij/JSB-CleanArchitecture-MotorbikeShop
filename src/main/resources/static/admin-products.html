<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω S·∫£n ph·∫©m - Admin Panel</title>
    <link rel="stylesheet" href="css/common.css?v=3">
    <link rel="stylesheet" href="css/admin.css?v=3">
</head>
<body data-page="products">
    <!-- Admin Sidebar will be loaded by admin-sidebar.js -->

    <!-- Main Content Area -->
    <div class="admin-main">
        <div class="admin-header">
            <h1>Qu·∫£n l√Ω S·∫£n ph·∫©m</h1>
            <p>Qu·∫£n l√Ω xe m√°y v√† ph·ª• ki·ªán</p>
        </div>

        <div class="admin-content">
            <div id="alertContainer"></div>

            <!-- Tabs -->
            <div class="tabs-container">
                <button class="tab-btn active" onclick="switchTab('motorbikes')">XE M√ÅY</button>
                <button class="tab-btn" onclick="switchTab('accessories')">PH·ª§ KI·ªÜN</button>
            </div>

            <!-- Motorbikes Tab -->
            <div id="motorbikesTab" class="tab-content active">
                <div class="section-actions">
                    <button class="btn-add" onclick="exportMotorbikes()" style="background: #f59e0b;">üìÑ Export Excel</button>
                    <button class="btn-add" onclick="showImportMotorbikeModal()" style="background: #10b981;">üìä Import Excel</button>
                    <button class="btn-add" onclick="showAddMotorbikeModal()">+ TH√äM XE M√ÅY</button>
                </div>

                <!-- Search Bar -->
                <div class="search-bar">
                    <form class="search-form" onsubmit="searchMotorbikes(event)">
                        <div class="form-group">
                            <label>T√äN XE</label>
                            <input type="text" id="searchMotorbikeName" placeholder="Nh·∫≠p t√™n xe m√°y...">
                        </div>
                        <div class="form-group">
                            <label>H√ÉNG XE</label>
                            <select id="filterMotorbikeBrand" onchange="applyMotorbikeFilters()">
                                <option value="">T·∫•t c·∫£</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>M√ÄU S·∫ÆC</label>
                            <select id="filterMotorbikeColor" onchange="applyMotorbikeFilters()">
                                <option value="">T·∫•t c·∫£</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>TR·∫†NG TH√ÅI</label>
                            <select id="filterMotorbikeAvailability" onchange="applyMotorbikeFilters()">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="available">Hi·ªÉn th·ªã</option>
                                <option value="hidden">ƒê√£ ·∫©n</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>S·∫ÆP X·∫æP</label>
                            <select id="sortMotorbikeOrder" onchange="applyMotorbikeFilters()">
                                <option value="newest">M·ªõi nh·∫•t</option>
                                <option value="oldest">C≈© nh·∫•t</option>
                                <option value="price-high">Gi√° cao nh·∫•t</option>
                                <option value="price-low">Gi√° th·∫•p nh·∫•t</option>
                                <option value="name-asc">T√™n A-Z</option>
                                <option value="name-desc">T√™n Z-A</option>
                            </select>
                        </div>
                    </form>
                </div>

                <!-- Motorbikes Table -->
                <div class="table-wrapper">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>H√åNH ·∫¢NH</th>
                                <th>T√äN XE</th>
                                <th>H√ÉNG</th>
                                <th>D√íNG XE</th>
                                <th>M√ÄU S·∫ÆC</th>
                                <th>NƒÇM SX</th>
                                <th>DUNG T√çCH</th>
                                <th>GI√Å</th>
                                <th>T·ªîN KHO</th>
                                <th>TR·∫†NG TH√ÅI</th>
                                <th>NG√ÄY T·∫†O</th>
                                <th>H√ÄNH ƒê·ªòNG</th>
                            </tr>
                        </thead>
                        <tbody id="motorbikesTableBody">
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 40px;">
                                    <div class="loading-spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Accessories Tab -->
            <div id="accessoriesTab" class="tab-content">
                <div class="section-actions">
                    <button class="btn-add" onclick="exportAccessories()" style="background: #f59e0b;">üìÑ Export Excel</button>
                    <button class="btn-add" onclick="showImportAccessoryModal()" style="background: #10b981;">üìä Import Excel</button>
                    <button class="btn-add" onclick="showAddAccessoryModal()">+ TH√äM PH·ª§ KI·ªÜN</button>
                </div>

                <!-- Search Bar -->
                <div class="search-bar">
                    <form class="search-form" onsubmit="searchAccessories(event)">
                        <div class="form-group">
                            <label>T√äN PH·ª§ KI·ªÜN</label>
                            <input type="text" id="searchAccessoryName" placeholder="Nh·∫≠p t√™n ph·ª• ki·ªán...">
                        </div>
                        <div class="form-group">
                            <label>LO·∫†I PH·ª§ KI·ªÜN</label>
                            <select id="filterAccessoryType" onchange="applyAccessoryFilters()">
                                <option value="">T·∫•t c·∫£</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>TH∆Ø∆†NG HI·ªÜU</label>
                            <select id="filterAccessoryBrand" onchange="applyAccessoryFilters()">
                                <option value="">T·∫•t c·∫£</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>TR·∫†NG TH√ÅI</label>
                            <select id="filterAccessoryAvailability" onchange="applyAccessoryFilters()">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="available">Hi·ªÉn th·ªã</option>
                                <option value="hidden">ƒê√£ ·∫©n</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>S·∫ÆP X·∫æP</label>
                            <select id="sortAccessoryOrder" onchange="applyAccessoryFilters()">
                                <option value="newest">M·ªõi nh·∫•t</option>
                                <option value="oldest">C≈© nh·∫•t</option>
                                <option value="price-high">Gi√° cao nh·∫•t</option>
                                <option value="price-low">Gi√° th·∫•p nh·∫•t</option>
                                <option value="name-asc">T√™n A-Z</option>
                                <option value="name-desc">T√™n Z-A</option>
                            </select>
                        </div>
                    </form>
                </div>

                <!-- Accessories Table -->
                <div class="table-wrapper">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>H√åNH ·∫¢NH</th>
                                <th>T√äN PH·ª§ KI·ªÜN</th>
                                <th>LO·∫†I</th>
                                <th>TH∆Ø∆†NG HI·ªÜU</th>
                                <th>CH·∫§T LI·ªÜU</th>
                                <th>K√çCH TH∆Ø·ªöC</th>
                                <th>GI√Å</th>
                                <th>T·ªîN KHO</th>
                                <th>TR·∫†NG TH√ÅI</th>
                                <th>NG√ÄY T·∫†O</th>
                                <th>H√ÄNH ƒê·ªòNG</th>
                            </tr>
                        </thead>
                        <tbody id="accessoriesTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 40px;">
                                    <div class="loading-spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Motorbike Modal -->
    <div id="motorbikeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="motorbikeModalTitle">TH√äM XE M√ÅY</h2>
            </div>
            <div class="modal-body">
                <form id="motorbikeForm">
                    <input type="hidden" id="motorbikeId">
                    
                    <div class="form-group">
                        <label>T√äN XE *</label>
                        <input type="text" id="motorbikeName" required>
                    </div>

                    <div class="form-group">
                        <label>H√ÉNG *</label>
                        <input type="text" id="motorbikeBrand" required>
                    </div>

                    <div class="form-group">
                        <label>D√íNG XE *</label>
                        <input type="text" id="motorbikeModel" required>
                    </div>

                    <div class="form-group">
                        <label>M√ÄU S·∫ÆC *</label>
                        <input type="text" id="motorbikeColor" required>
                    </div>

                    <div class="form-group">
                        <label>NƒÇM S·∫¢N XU·∫§T *</label>
                        <input type="number" id="motorbikeYear" required min="2000" max="2030">
                    </div>

                    <div class="form-group">
                        <label>DUNG T√çCH (cc) *</label>
                        <input type="number" id="motorbikeDisplacement" required min="0">
                    </div>

                    <div class="form-group">
                        <label>GI√Å *</label>
                        <input type="number" id="motorbikePrice" required min="0">
                    </div>

                    <div class="form-group">
                        <label>S·ªê L∆Ø·ª¢NG *</label>
                        <input type="number" id="motorbikeStock" required min="0">
                    </div>

                    <div class="form-group">
                        <label>LINK H√åNH ·∫¢NH</label>
                        <input type="text" id="motorbikeImage" placeholder="https://...">
                    </div>

                    <div class="form-group">
                        <label>M√î T·∫¢</label>
                        <textarea id="motorbikeDescription" rows="4"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeMotorbikeModal()">H·ª¶Y</button>
                <button class="btn-submit" onclick="saveMotorbike()">L∆ØU</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Accessory Modal -->
    <div id="accessoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="accessoryModalTitle">TH√äM PH·ª§ KI·ªÜN</h2>
            </div>
            <div class="modal-body">
                <form id="accessoryForm">
                    <input type="hidden" id="accessoryId">
                    
                    <div class="form-group">
                        <label>T√äN PH·ª§ KI·ªÜN *</label>
                        <input type="text" id="accessoryName" required>
                    </div>

                    <div class="form-group">
                        <label>LO·∫†I *</label>
                        <input type="text" id="accessoryType" required>
                    </div>

                    <div class="form-group">
                        <label>TH∆Ø∆†NG HI·ªÜU *</label>
                        <input type="text" id="accessoryBrand" required>
                    </div>

                    <div class="form-group">
                        <label>CH·∫§T LI·ªÜU *</label>
                        <input type="text" id="accessoryMaterial" required>
                    </div>

                    <div class="form-group">
                        <label>K√çCH TH∆Ø·ªöC *</label>
                        <input type="text" id="accessorySize" required>
                    </div>

                    <div class="form-group">
                        <label>GI√Å *</label>
                        <input type="number" id="accessoryPrice" required min="0">
                    </div>

                    <div class="form-group">
                        <label>S·ªê L∆Ø·ª¢NG *</label>
                        <input type="number" id="accessoryStock" required min="0">
                    </div>

                    <div class="form-group">
                        <label>LINK H√åNH ·∫¢NH</label>
                        <input type="text" id="accessoryImage" placeholder="https://...">
                    </div>

                    <div class="form-group">
                        <label>M√î T·∫¢</label>
                        <textarea id="accessoryDescription" rows="4"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeAccessoryModal()">H·ª¶Y</button>
                <button class="btn-submit" onclick="saveAccessory()">L∆ØU</button>
            </div>
        </div>
    </div>

    <!-- Import Motorbike Modal -->
    <div id="importMotorbikeModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Import Xe m√°y t·ª´ Excel</h2>
            </div>
            <div class="modal-body">
                <!-- Template Download -->
                <div style="background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                    <h3 style="margin: 0 0 8px 0; color: #0369a1;">üìÑ T·∫£i Template Excel</h3>
                    <p style="margin: 0 0 12px 0; color: #075985; font-size: 14px;">T·∫£i file m·∫´u ƒë·ªÉ bi·∫øt ƒë·ªãnh d·∫°ng ƒë√∫ng. File Excel c·∫ßn 10 c·ªôt theo th·ª© t·ª±:</p>
                    <p style="margin: 0 0 12px 0; color: #0c4a6e; font-size: 13px; font-weight: 600;">
                        T√™n SP | M√¥ t·∫£ | Gi√° | H√¨nh ·∫£nh | T·ªìn kho | H√£ng | D√≤ng | M√†u | NƒÉm SX | Dung t√≠ch
                    </p>
                    <button class="btn-add" onclick="downloadMotorbikeTemplate()" style="background: #0ea5e9;">‚¨áÔ∏è T·∫£i Template Excel</button>
                </div>

                <!-- File Upload Area -->
                <div id="uploadAreaMotorbike" class="upload-area" 
                     ondrop="handleMotorbikeFileDrop(event)" 
                     ondragover="handleDragOver(event)" 
                     ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">üìÅ</div>
                    <p class="upload-text">K√©o th·∫£ file Excel/CSV v√†o ƒë√¢y ho·∫∑c</p>
                    <input type="file" id="excelFileInputMotorbike" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleMotorbikeFileSelect(event)">
                    <button class="btn-add" onclick="document.getElementById('excelFileInputMotorbike').click()">Ch·ªçn file</button>
                    <p class="upload-hint">H·ªó tr·ª£: .xlsx, .xls, .csv (t·ªëi ƒëa 10MB)</p>
                </div>

                <!-- Selected File Info -->
                <div id="fileInfoMotorbike" class="file-info hidden">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üìä</span>
                        <div style="flex: 1;">
                            <p style="margin: 0; font-weight: 600;" id="fileNameMotorbike"></p>
                            <p style="margin: 0; font-size: 14px; color: #666;" id="fileSizeMotorbike"></p>
                        </div>
                        <button class="btn-action btn-delete" onclick="clearMotorbikeFileSelection()">‚úï</button>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div id="importProgressMotorbike" class="import-progress hidden">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFillMotorbike"></div>
                    </div>
                    <p id="progressTextMotorbike" style="text-align: center; margin-top: 8px; color: #666;">ƒêang x·ª≠ l√Ω...</p>
                </div>

                <!-- Import Results -->
                <div id="importResultsMotorbike" class="import-results hidden">
                    <h3 style="margin: 0 0 16px 0; color: #059669;">‚úÖ K·∫øt qu·∫£ Import</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
                        <div style="background: #f0f9ff; padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="margin: 0; font-size: 24px; font-weight: 700; color: #0369a1;" id="totalRecordsMotorbike">0</p>
                            <p style="margin: 4px 0 0 0; font-size: 14px; color: #075985;">T·ªïng s·ªë</p>
                        </div>
                        <div style="background: #f0fdf4; padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="margin: 0; font-size: 24px; font-weight: 700; color: #059669;" id="successCountMotorbike">0</p>
                            <p style="margin: 4px 0 0 0; font-size: 14px; color: #047857;">Th√†nh c√¥ng</p>
                        </div>
                        <div style="background: #fef2f2; padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="margin: 0; font-size: 24px; font-weight: 700; color: #dc2626;" id="failureCountMotorbike">0</p>
                            <p style="margin: 4px 0 0 0; font-size: 14px; color: #991b1b;">Th·∫•t b·∫°i</p>
                        </div>
                    </div>
                    
                    <!-- Error List -->
                    <div id="errorListContainerMotorbike" class="hidden">
                        <h4 style="margin: 0 0 8px 0; color: #dc2626;">‚ùå L·ªói chi ti·∫øt:</h4>
                        <div id="errorListMotorbike" style="max-height: 200px; overflow-y: auto; background: #fef2f2; border: 1px solid #fca5a5; border-radius: 8px; padding: 12px;">
                            <!-- Errors will be listed here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeImportMotorbikeModal()">ƒê√≥ng</button>
                <button class="btn-submit" id="btnImportMotorbike" onclick="submitMotorbikeImport()" disabled>üì§ Import</button>
            </div>
        </div>
    </div>

    <!-- Import Accessory Modal -->
    <div id="importAccessoryModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Import Ph·ª• ki·ªán t·ª´ Excel</h2>
            </div>
            <div class="modal-body">
                <!-- Template Download -->
                <div style="background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                    <h3 style="margin: 0 0 8px 0; color: #0369a1;">üìÑ T·∫£i Template Excel</h3>
                    <p style="margin: 0 0 12px 0; color: #075985; font-size: 14px;">T·∫£i file m·∫´u ƒë·ªÉ bi·∫øt ƒë·ªãnh d·∫°ng ƒë√∫ng. File Excel c·∫ßn 8 c·ªôt theo th·ª© t·ª±:</p>
                    <p style="margin: 0 0 12px 0; color: #0c4a6e; font-size: 13px; font-weight: 600;">
                        T√™n SP | M√¥ t·∫£ | Gi√° | H√¨nh ·∫£nh | T·ªìn kho | Lo·∫°i | Th∆∞∆°ng hi·ªáu | Ch·∫•t li·ªáu
                    </p>
                    <button class="btn-add" onclick="downloadAccessoryTemplate()" style="background: #0ea5e9;">‚¨áÔ∏è T·∫£i Template Excel</button>
                </div>

                <!-- File Upload Area -->
                <div id="uploadAreaAccessory" class="upload-area" 
                     ondrop="handleAccessoryFileDrop(event)" 
                     ondragover="handleDragOver(event)" 
                     ondragleave="handleDragLeave(event)">
                    <div class="upload-icon">üìÅ</div>
                    <p class="upload-text">K√©o th·∫£ file Excel/CSV v√†o ƒë√¢y ho·∫∑c</p>
                    <input type="file" id="excelFileInputAccessory" accept=".xlsx,.xls,.csv" style="display: none;" onchange="handleAccessoryFileSelect(event)">
                    <button class="btn-add" onclick="document.getElementById('excelFileInputAccessory').click()">Ch·ªçn file</button>
                    <p class="upload-hint">H·ªó tr·ª£: .xlsx, .xls, .csv (t·ªëi ƒëa 10MB)</p>
                </div>

                <!-- Selected File Info -->
                <div id="fileInfoAccessory" class="file-info hidden">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 24px;">üìä</span>
                        <div style="flex: 1;">
                            <p style="margin: 0; font-weight: 600;" id="fileNameAccessory"></p>
                            <p style="margin: 0; font-size: 14px; color: #666;" id="fileSizeAccessory"></p>
                        </div>
                        <button class="btn-action btn-delete" onclick="clearAccessoryFileSelection()">‚úï</button>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div id="importProgressAccessory" class="import-progress hidden">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFillAccessory"></div>
                    </div>
                    <p id="progressTextAccessory" style="text-align: center; margin-top: 8px; color: #666;">ƒêang x·ª≠ l√Ω...</p>
                </div>

                <!-- Import Results -->
                <div id="importResultsAccessory" class="import-results hidden">
                    <h3 style="margin: 0 0 16px 0; color: #059669;">‚úÖ K·∫øt qu·∫£ Import</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
                        <div style="background: #f0f9ff; padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="margin: 0; font-size: 24px; font-weight: 700; color: #0369a1;" id="totalRecordsAccessory">0</p>
                            <p style="margin: 4px 0 0 0; font-size: 14px; color: #075985;">T·ªïng s·ªë</p>
                        </div>
                        <div style="background: #f0fdf4; padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="margin: 0; font-size: 24px; font-weight: 700; color: #059669;" id="successCountAccessory">0</p>
                            <p style="margin: 4px 0 0 0; font-size: 14px; color: #047857;">Th√†nh c√¥ng</p>
                        </div>
                        <div style="background: #fef2f2; padding: 12px; border-radius: 8px; text-align: center;">
                            <p style="margin: 0; font-size: 24px; font-weight: 700; color: #dc2626;" id="failureCountAccessory">0</p>
                            <p style="margin: 4px 0 0 0; font-size: 14px; color: #991b1b;">Th·∫•t b·∫°i</p>
                        </div>
                    </div>
                    
                    <!-- Error List -->
                    <div id="errorListContainerAccessory" class="hidden">
                        <h4 style="margin: 0 0 8px 0; color: #dc2626;">‚ùå L·ªói chi ti·∫øt:</h4>
                        <div id="errorListAccessory" style="max-height: 200px; overflow-y: auto; background: #fef2f2; border: 1px solid #fca5a5; border-radius: 8px; padding: 12px;">
                            <!-- Errors will be listed here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeImportAccessoryModal()">ƒê√≥ng</button>
                <button class="btn-submit" id="btnImportAccessory" onclick="submitAccessoryImport()" disabled>üì§ Import</button>
            </div>
        </div>
    </div>

    <script src="js/admin-sidebar.js?v=1"></script>
    <script src="js/common.js?v=3"></script>
    <script src="js/admin-products.js?v=3"></script>
</body>
</html>
